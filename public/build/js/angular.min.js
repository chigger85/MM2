angular.module("userApp",["ngAnimate","ui.bootstrap","app.routes","authService","mainCtrl","userCtrl","fixtureCtrl","userService","fixtureService","fixtureAttendService","goalService"]).config(function(a){a.interceptors.push("AuthInterceptor")}),angular.module("app.routes",["ngRoute"]).config(["$routeProvider","$locationProvider",function(a,b){a.when("/",{templateUrl:"app/views/pages/home.html"}).when("/login",{templateUrl:"app/views/pages/login.html",controller:"mainController",controllerAs:"login"}).when("/users",{templateUrl:"app/views/pages/users/all.html",controller:"userController",controllerAs:"user"}).when("/users/create",{templateUrl:"app/views/pages/users/single.html",controller:"userCreateController",controllerAs:"user"}).when("/users/:user_id",{templateUrl:"app/views/pages/users/single.html",controller:"userEditController",controllerAs:"user"}).when("/availability",{templateUrl:"app/views/pages/users/availability2.html",controller:"fixtureController",controllerAs:"fixture"}).when("/availability/create",{templateUrl:"app/views/pages/users/createFixture.html",controller:"fixtureCreateController",controllerAs:"fixture"}).when("/availability/:fixture_id",{templateUrl:"app/views/pages/users/fixture.html",controller:"fixtureEditController",controllerAs:"fixture"}).when("/afc_match_centre",{templateUrl:"app/views/pages/users/league.html",controller:"fixtureEditController",controllerAs:"fixture"}),b.html5Mode(!0)}]),angular.module("mainCtrl",["ui.bootstrap"]).controller("mainController",["$rootScope","$location","Auth",function(a,b,c){var d=this;a.$on("$routeChangeStart",function(){d.loggedIn=c.isLoggedIn(),c.getUser().then(function(a){d.user=a.data,console.log(d.user)})}),d.doLogin=function(){d.processing=!0,d.error="",c.login(d.loginData.username,d.loginData.password).success(function(a){d.processing=!1,a.success?b.path("/users"):d.error=a.message})},d.doLogout=function(){c.logout(),d.user="",b.path("/login")}}]),angular.module("userCtrl",["userService"]).controller("userController",["$scope","User","Auth","$route","$log","$modal",function(a,b,c,d,e,f){a.processing=!0,a.refresh=function(){b.all().success(function(b){a.processing=!1,a.users=b})},a.refresh(),a.deleteUser=function(c){a.processing=!0,b["delete"](c).success(function(c){b.all().success(function(b){a.processing=!1,a.users=b})})},a.edit=function(c){console.log(c),b.get(c).success(function(b){a.userData=b,a.userData.dob=new Date(a.userData.dob)})},a.open_submit=function(){var b=f.open({animation:!0,templateUrl:"modalSubmitUser.html",controller:"modalSubmitUser",scope:a,size:"lg"});b.result.then(function(){d.reload()},function(){e.info("Modal dismissed at: "+new Date)})},a.open_edit=function(){var b=f.open({animation:!0,templateUrl:"modalEditUser.html",controller:"modalEditUser",scope:a,size:"lg"});b.result.then(function(){d.reload()},function(){e.info("Modal dismissed at: "+new Date)})},a.open_delete=function(){var b=f.open({animation:!0,templateUrl:"modalDeleteUser.html",controller:"modalDeleteUser",scope:a});b.result.then(function(){d.reload()},function(){e.info("Modal dismissed at: "+new Date)})}}]).controller("modalSubmitUser",["$scope","User","$location","$timeout","$modalInstance","$route",function(a,b,c,d,e,f){a.message="User Created",a.type="create",a.ok=function(){e.close(a.message)},a.cancel=function(){e.dismiss("cancel")},a.addUser=function(){a.processing=!0,a.message="",b.create(a.userData).success(function(b){a.processing=!1,a.userData={},a.message=b.message}),d(function(){c.path("/users")},2e3)},a.deselect=function(){a.userData={}}}]).controller("modalEditUser",["$scope","User","$location","$timeout","$modalInstance","$route",function(a,b,c,d,e,f){a.message="User updated",a.ok=function(){e.close(a.message)},a.cancel=function(){e.dismiss("cancel")},a.submit=function(){b.update(a.userData._id,a.userData).success(function(b){a.processing=!1,a.userData={},a.message=b.message,console.log(b.message),f.reload()})},a.deselect=function(){a.userData=""}}]).controller("modalDeleteUser",["$scope","User","$modalInstance","$route",function(a,b,c,d){a.message="User deleted",a.ok=function(){c.close(a.message)},a.cancel=function(){c.dismiss("cancel")},a.deleteUser=function(){a.processing=!0,b["delete"](a.userData._id).success(function(c){b.all().success(function(b){a.processing=!1,a.fixtures=b}),d.reload()})}}]).controller("userCreateController",["$scope","User","$location","$timeout",function(a,b,c,d){a.type="create",a.saveUser=function(){a.processing=!0,a.message="",b.create(a.userData).success(function(b){a.processing=!1,a.userData={},a.message=b.message}),d(function(){c.path("/login")},2e3)}}]).controller("userEditController",["User","$routeParams","$location","$timeout",function(a,b,c,d){var e=this;e.type="edit",a.get(b.user_id).success(function(a){e.userData=a,e.userData.dob=new Date(e.userData.dob)}),e.saveUser=function(){e.processing=!0,e.message="",a.update(b.user_id,e.userData).success(function(a){e.processing=!1,e.userData={},e.message=a.message}),d(function(){c.path("/users")},1e3)}}]),angular.module("fixtureCtrl",["fixtureService","userService","authService","fixtureAttendService"]).controller("fixtureController",["$scope","Fixture","FixtureAttend","Auth","$location","$route","$modal","$log",function(a,b,c,d,e,f,g,h){a.processing=!0,a.fixture_status=function(c){b.get(c).success(function(b){a.status=b.status,console.log(a.status)})},a.refresh=function(){b.all().success(function(b){a.processing=!1,a.fixtures=b})},a.refresh(),d.getUser().then(function(b){a.user=b.data}),a.edit=function(c){console.log(c),b.get(c).success(function(b){a.fixtureData=b,a.fixtureData.date=new Date(a.fixtureData.date)})},a.getAttend=function(b){c.getAttendance(b).success(function(b){a.attData=b,console.log(a.user)})},a.removeAttend=function(b){c.removeAttendance(b).success(function(d){a.message=d.message,console.log(d.message),c.getAttendance(b).success(function(b){a.attData=b,console.log(b),console.log(a.user.id),a.refresh()})})},a.addAttend=function(b){c.addAttendance(b).success(function(d){a.message=d.message,console.log(d.message),c.getAttendance(b).success(function(b){a.attData=b,console.log(b),console.log(a.user.id),a.refresh()})})},a.open_submit=function(){a.fixtureData="";var b=g.open({animation:!0,templateUrl:"modalSubmitFixture.html",controller:"modalSubmitFixture",scope:a});b.result.then(function(){f.reload()},function(){h.info("Modal dismissed at: "+new Date)})},a.open_edit=function(){var b=g.open({animation:!0,templateUrl:"modalEditFixture.html",controller:"modalEditFixture",scope:a});b.result.then(function(){f.reload()},function(){h.info("Modal dismissed at: "+new Date)})},a.open_delete=function(){var b=g.open({animation:!0,templateUrl:"modalDeleteFixture.html",controller:"modalDeleteFixture",scope:a});b.result.then(function(){f.reload()},function(){h.info("Modal dismissed at: "+new Date)})}}]).controller("modalSubmitFixture",["$scope","Fixture","$modalInstance","$route",function(a,b,c,d){a.message="Fixture created",a.ok=function(){c.close(a.message)},a.cancel=function(){c.dismiss("cancel")},a.addFixture=function(){a.processing=!0,a.message="",b.create(a.fixtureData).success(function(b){a.processing=!1,a.fixtureData={},a.message=b.message,a.fixtureData=""})},a.deselect=function(){a.fixtureData={}}}]).controller("modalEditFixture",["$scope","Fixture","$modalInstance","$route",function(a,b,c,d){a.message="Fixture updated",a.ok=function(){c.close(a.message)},a.cancel=function(){c.dismiss("cancel")},a.submit=function(){b.update(a.fixtureData._id,a.fixtureData).success(function(b){a.processing=!1,a.fixtureData={},a.message=b.message,console.log(b.message),d.reload()})},a.deselect=function(){a.fixtureData=""}}]).controller("modalDeleteFixture",["$scope","Fixture","$modalInstance","$route",function(a,b,c,d){a.message="Fixture created",a.ok=function(){c.close(a.message)},a.cancel=function(){c.dismiss("cancel")},a.deleteFixture=function(){a.processing=!0,b["delete"](a.fixtureData._id).success(function(c){b.all().success(function(b){a.processing=!1,a.fixtures=b}),d.reload()})}}]),angular.module("authService",[]).factory("Auth",["$http","$q","AuthToken",function(a,b,c){var d={};return d.login=function(b,d){return a.post("/api/authenticate",{username:b,password:d}).success(function(a){return c.setToken(a.token),a})},d.createLogin=function(b,d){return a.post("/api/authenticate",{username:b,password:d}).success(function(a){return c.setToken(a.token),a})},d.logout=function(){c.setToken()},d.isLoggedIn=function(){return c.getToken()?!0:!1},d.getUser=function(){return c.getToken()?a.get("/api/me"):b.reject({message:"User has no token."})},d}]).factory("AuthToken",["$window",function(a){var b={};return b.getToken=function(){return a.localStorage.getItem("token")},b.setToken=function(b){b?a.localStorage.setItem("token",b):a.localStorage.removeItem("token")},b}]).factory("AuthInterceptor",["$q","$location","AuthToken",function(a,b,c){var d={};return d.request=function(a){var b=c.getToken();return b&&(a.headers["x-access-token"]=b),a},d.responseError=function(d){return 403==d.status&&(c.setToken(),b.path("/login")),a.reject(d)},d}]),angular.module("fixtureAttendService",[]).factory("FixtureAttend",["$http",function(a){var b={};return b.getAttendance=function(b){return a.get("/api/fixtures/"+b+"/availability")},b.addAttendance=function(b){return a.put("/api/fixtures/"+b+"/yes")},b.removeAttendance=function(b){return a.put("/api/fixtures/"+b+"/no")},b}]),angular.module("fixtureService",["userService"]).factory("Fixture",["$http","User",function(a,b){var c={};return c.get=function(b){return a.get("/api/fixtures/"+b)},c.all=function(){return a.get("/api/fixtures/")},c.create=function(b){return a.post("api/fixtures/",b)},c.update=function(b,c){return a.put("/api/fixtures/"+b,c)},c["delete"]=function(b){return a["delete"]("/api/fixtures/"+b)},c.attending=function(b){return a.get("/api/fixtures/"+b)},c}]),angular.module("goalService",[]).factory("Goal",["$http",function(a){var b={};return b.get=function(b){return a.get("/api/goals/"+b)},b.all=function(){return a.get("/api/goals/")},b.create=function(b){return a.post("api/goals/",b)},b.update=function(b,c){return a.put("/api/goals/"+b,c)},b["delete"]=function(b){return a["delete"]("/api/goals/"+b)},b}]),angular.module("userService",[]).factory("User",["$http",function(a){var b={};return b.get=function(b){return a.get("/api/users/"+b)},b.all=function(){return a.get("/api/users/")},b.create=function(b){return a.post("api/users/",b)},b.update=function(b,c){return a.put("/api/users/"+b,c)},b["delete"]=function(b){return a["delete"]("/api/users/"+b)},b}]);